
<!DOCTYPE html> 
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NeuroSites - Website Templates for Neuroscience</title>
  <style>
    /* ====== Base Palette ====== */
    :root {
      --bg: #101532;
      --fg: #fafdff;
      --muted: rgba(250, 253, 255, 0.8);
      --card: rgba(250, 253, 255, 0.1);
      --shadow: rgba(16, 21, 50, 0.4);
      --border: #e1e8ed;
      --accent: #6288a7;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: Inter, Roboto, 'Helvetica Neue', 'Arial Nova', 'Nimbus Sans', Arial, sans-serif;
      font-weight: 400;
      line-height: 1.6;
      color: var(--fg);
      background: var(--bg);
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }

    /* ====== Existing Header ====== */
    header.site-header { /* renamed to avoid conflict with sticky header wrapper */
      background: var(--bg);
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 20px var(--shadow);
      padding: 10rem 0 6.5rem 0; /* increased top padding from 2rem to 5rem */
      margin-bottom: 3rem;
      position: relative;
      z-index: 1;
    }

    .header-content { text-align: center; }
    .logo-container { margin-bottom: .5rem; }
    .logo { max-height: 400px; width: auto; margin: 0 auto; display: block; }
    .subtitle { font-size: 1.2rem; color: var(--muted); margin-bottom: 3rem; }

    /* --- Sleek feature pills --- */
    .stats { 
    display: flex; 
    justify-content: center; 
    gap: 1rem; 
    margin-bottom: 2.5rem;
    flex-wrap: wrap;
    }
    .stat {
    --h: 100px;
    display: grid;
    grid-template-columns: 60px 1fr;
    align-items: center;
    gap: .85rem;
    height: var(--h);
    min-width: 340px;
    padding: 1rem 1.2rem;
    border-radius: 9999px;
    background: linear-gradient(180deg, rgba(250,253,255,.10), rgba(250,253,255,.06));
    border: 1px solid rgba(250,253,255,.16);
    box-shadow: 0 10px 26px rgba(0,0,0,.18);
    transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
    }
    .stat:hover {
    transform: translateY(-2px);
    box-shadow: 0 18px 40px rgba(0,0,0,.24);
    border-color: rgba(250,253,255,.24);
    }
    .stat-icon {
    width: 60px; height: 60px;
    border-radius: 9999px;
    display: grid; place-items: center;
    background: radial-gradient(120% 120% at 30% 20%, rgba(98,136,167,.35), rgba(98,136,167,.12));
    border: 1px solid rgba(98,136,167,.45);
    }
    .stat-title { font-size: 1.02rem; font-weight: 800; margin: 0; line-height: 1.1; }
    .stat-description { margin: .15rem 0 0 0; font-size: .9rem; color: rgba(250,253,255,.78); }

    /* Tighter on small screens */
    @media (max-width: 820px){
    .stat { min-width: 260px; --h: 56px; }
    .stat-description { font-size: .88rem; }
    }

    .scroll-indicator { position: absolute; bottom: 2.5rem; left: 50%; transform: translateX(-50%); display: flex; flex-direction: column; align-items: center; color: rgba(250, 253, 255, 0.7); cursor: pointer; transition: all .3s ease; animation: bounce 2s infinite; z-index: 2; }
    .scroll-indicator:hover { color: var(--accent); }
    .scroll-arrow { font-size: 1.5rem; margin-bottom: .5rem; }
    .scroll-text { font-size: .85rem; text-transform: uppercase; letter-spacing: 1px; }
    @keyframes bounce { 0%,20%,50%,80%,100%{ transform: translateX(-50%) translateY(0);} 40%{ transform: translateX(-50%) translateY(-10px);} 60%{ transform: translateX(-50%) translateY(-5px);} }

    /* ====== Sticky Floating Pill Nav with Dropdown Button ====== */
    /* Wrapper that manages sticky state */
    #stickyHeader { position: relative; z-index: 9999; }

    /* Floating pill nav centered under the hero; shrinks on scroll */
    #stickyHeader nav.pill {
      position: fixed;
      left: 0; right: 0; top: 50px;
      width: 700px; height: 80px; margin: 0 auto;
      display: flex; justify-content: center; align-items: center; gap: 25px;
      padding: 0 20px;
      background-color: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 200px; backdrop-filter: blur(8px);
      transition: 1s all cubic-bezier(0.075, 0.82, 0.165, 1) .2s;
    }

    #stickyHeader nav.pill a {
      color: var(--fg); text-decoration: none; font-weight: 700; display: block;
      padding: 10px 16px; line-height: 1; font-size: 17px; letter-spacing: 2px; text-transform: lowercase;
      font-family: Seravek, 'Gill Sans Nova', Ubuntu, Calibri, 'DejaVu Sans', source-sans-pro, sans-serif;
      font-weight: 900;
      opacity: 1; transform: scale(1); transition: .4s opacity, .4s transform, .3s font-size;
    }

    #stickyHeader nav.pill a:hover {
      font-size: 25px;
    }

    /* Special styling for Templates link */
    #stickyHeader nav.pill a[href="#templates"] {
      background: var(--accent);
      width: 550px; height: 40px; margin: 0 auto;
      border-radius: 200px;
      color: var(--fg);
      text-shadow: 
        -1px -1px 0 rgba(255,255,255,.12),
        1px -1px 0 rgba(255,255,255,.12),
        -1px 1px 0 rgba(255,255,255,.12),
        1px 1px 0 rgba(255,255,255,.12);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Circular menu button that appears when shrunk */
    #openmenu {
      -webkit-appearance: none; appearance: none; cursor: pointer; outline: 0; border: 0;
      position: absolute; left: 0; right: 0; top: 0; bottom: 0; margin: auto;
      width: 50px; height: 50px; border-radius: 50%;
      background: rgba(0,0,0,.35); border: 1px solid rgba(255,255,255,.18);
      backdrop-filter: blur(5px);
      display: flex; align-items: center; justify-content: center; gap: 6px; flex-direction: column;
      transform: scale(0); transition: .3s transform ease .2s, border-color .3s;
    }
    #openmenu span { width: 40%; height: 2px; background: var(--fg); transform: scaleX(0); transition: .5s transform ease .1s, .2s margin; }
    #openmenu:hover { border-color: rgba(255,255,255,.5); }
    #openmenu:hover span { margin: 2px 0; }

    /* Sticky (scrolled) state shrinks the pill into a circle and hides links */
    #stickyHeader.sticky nav.pill { top: 20px; width: 80px; height: 80px; padding: 0; }
    #stickyHeader.sticky nav.pill a { opacity: 0; transform: scale(.4); pointer-events: none; }
    #stickyHeader.sticky #openmenu { transform: scale(1); }
    #stickyHeader.sticky #openmenu span { transform: scaleX(1); }

    /* Page blur/zoom when menu is open */
    #page { position: relative; transition: 1s all ease-in-out; }
    #page.menuopen { opacity: .6; filter: blur(16px); transform: scale(1.02); }

    /* Fullscreen dropdown menu */
    .dropdown-overlay { position: fixed; inset: 0; display: none; place-items: center; background: rgba(0,0,0,.6); z-index: 9998; }
    .dropdown-overlay.active { display: grid; }
    .dropdown-panel {
      width: min(92vw, 720px);
      background: rgba(16,21,50,.9);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 24px;
      backdrop-filter: blur(10px);
      padding: 28px;
      box-shadow: 0 30px 80px rgba(0,0,0,.4);
      animation: panelIn .35s ease;
    }
    @keyframes panelIn { from { transform: translateY(10px); opacity: 0;} to { transform: translateY(0); opacity: 1;} }

    /* AGGRESSIVE underline removal for menu cards */
    a.menu-card,
    a.menu-card:link,
    a.menu-card:visited,
    a.menu-card:hover,
    a.menu-card:active,
    a.menu-card:focus {
      text-decoration: none !important;
      text-decoration-line: none !important;
      text-decoration-style: none !important;
      text-decoration-color: transparent !important;
      text-underline-offset: 0 !important;
      border-bottom: none !important;
      box-shadow: none !important;
      outline: none !important;
    }
    
    a.menu-card h4,
    a.menu-card p,
    a.menu-card:link h4,
    a.menu-card:link p,
    a.menu-card:visited h4,
    a.menu-card:visited p,
    a.menu-card:hover h4,
    a.menu-card:hover p,
    a.menu-card:active h4,
    a.menu-card:active p,
    a.menu-card:focus h4,
    a.menu-card:focus p {
      text-decoration: none !important;
      text-decoration-line: none !important;
      text-decoration-style: none !important;
      text-decoration-color: transparent !important;
      text-underline-offset: 0 !important;
      border-bottom: none !important;
    }

    .menu-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px; }
    .menu-card { background: rgba(250,253,255,.06); border: 1px solid rgba(250,253,255,.12); border-radius: 16px; padding: 16px; transition: transform .2s, box-shadow .2s; }
    .menu-card:hover { transform: translateY(-4px); box-shadow: 0 16px 40px rgba(0,0,0,.25); }
    .menu-card h4 { margin-bottom: 6px; font-size: 1rem; color: var(--fg); letter-spacing: .5px; }
    .menu-card p { margin: 0; font-size: .9rem; color: rgba(250,253,255,.75); }
    /* Remove underlines from menu card links completely */
    .menu-card a { 
      color: var(--fg) !important; 
      text-decoration: none !important; 
      text-decoration-line: none !important;
      text-decoration-style: none !important;
      text-decoration-color: transparent !important;
      display: block; 
      border: none !important;
      border-bottom: none !important;
      outline: none !important;
    }
    .menu-card a:hover, 
    .menu-card a:visited, 
    .menu-card a:focus, 
    .menu-card a:active,
    .menu-card a:link { 
      text-decoration: none !important; 
      text-decoration-line: none !important;
      text-decoration-style: none !important;
      text-decoration-color: transparent !important;
      border: none !important;
      border-bottom: none !important;
      outline: none !important;
    }
    /* Ensure child elements don't inherit underlines */
    .menu-card a h4,
    .menu-card a p,
    .menu-card a *,
    a.menu-card h4,
    a.menu-card p,
    a.menu-card * {
      text-decoration: none !important;
      text-decoration-line: none !important;
      text-decoration-style: none !important;
      text-decoration-color: transparent !important;
      border-bottom: none !important;
    }

    .overlay-actions { display: flex; justify-content: flex-end; margin-top: 16px; gap: 10px; }
    .btn { padding: .65rem 1rem; border-radius: 10px; border: 1px solid rgba(255,255,255,.2); background: transparent; color: var(--fg); cursor: pointer; }
    .btn:hover { background: rgba(250,253,255,.08); }

    /* ====== Search Template Cards ====== */
    main {background: #E3EBF2; padding: 0; border-radius: 15px; box-shadow: 0 10px 30px rgba(16, 21, 50, 0.15); margin-bottom: 3rem; overflow: hidden; max-width: 1250px; margin-left: auto; margin-right: auto; }
    main .search-filter { background: transparent; color: inherit; padding: 0; border-radius: 0; box-shadow: none; margin-bottom: 0; overflow: visible; }
    
    /* Category Tabs */
    .filter-tabs { display: flex; gap: 0; border-bottom: 1px solid var(--border); background: #E3EBF2; margin: 0; padding: 0; }
    .filter-tab { 
      padding: 1rem 1rem; border: none; background: transparent; color: #5a6b7a; 
      cursor: pointer; transition: all .3s ease; font-size: 1.1rem; font-weight: 500;
      border-bottom: 3px solid transparent; position: relative; flex: 1; text-align: center;
      margin: 0; border-radius: 0;
    }
    .filter-tab:hover { background: rgba(98, 136, 167, 0.1); color: var(--accent); }
    .filter-tab.active { 
      background: rgba(98, 136, 167, 0.15); color: var(--accent); 
      border-bottom-color: var(--accent); font-weight: 600;
    }
    
    /* Search and Filter Section */
    .search-section { padding: 2rem; }
    .search-bar { display: flex; gap: 1rem; margin-bottom: 1.5rem; align-items: center; flex-wrap: wrap; }
    .search-input-container { position: relative; flex: 1; min-width: 200px; }
    #searchInput { 
      width: 100%; padding: 12px 20px 12px 50px; border: 2px solid var(--border); 
      border-radius: 25px; font-size: 1rem; outline: none; transition: border-color .3s ease; 
      background: var(--fg);
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%23101532' viewBox='0 0 16 16'%3e%3cpath d='M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z'/%3e%3c/svg%3e");
      background-repeat: no-repeat; 
      background-position: 15px center; 
      background-size: 20px;
    }
    #searchInput:focus { border-color: var(--accent); }
    
    .filter-dropdowns { display: flex; gap: 1rem; flex-wrap: wrap; }
    .dropdown-container { position: relative; min-width: 150px; }
    .dropdown-select { 
      width: 100%; padding: 10px 40px 10px 15px; border: 2px solid var(--border); 
      border-radius: 20px; background: var(--fg); color: var(--bg); font-size: .9rem; 
      cursor: pointer; outline: none; appearance: none; transition: border-color .3s ease;
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%23101532' viewBox='0 0 16 16'%3e%3cpath d='M8 11L3 6h10l-5 5z'/%3e%3c/svg%3e");
      background-repeat: no-repeat; background-position: right 12px center; background-size: 12px;
    }
    .dropdown-select:hover, .dropdown-select:focus { border-color: var(--accent); }

    .templates-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 2rem; margin-bottom: 0; padding: 2rem; }
    .template-card { background: var(--fg); color: var(--bg); border-radius: 15px; box-shadow: 0 10px 30px rgba(16, 21, 50, 0.15); overflow: hidden; transition: transform .3s ease, box-shadow .3s ease; cursor: pointer; }
    .template-card:hover { transform: translateY(-10px); box-shadow: 0 20px 40px rgba(16, 21, 50, 0.25); }
    .template-preview { height: 200px; background: linear-gradient(45deg, #f0f4f7, #e8eff3); display: flex; align-items: center; justify-content: center; font-size: 1.2rem; color: #5a6b7a; position: relative; overflow: hidden; }
    .template-info { padding: 1.5rem; }
    .template-title { font-size: 1.3rem; font-weight: 600; color: #101532; margin-bottom: .5rem; }
    .template-description { color: #5a6b7a; font-size: .9rem; margin-bottom: 1rem; line-height: 1.4; }
    .template-tags { display: flex; gap: .5rem; margin-bottom: 1rem; flex-wrap: wrap; }
    .tag { background: rgba(98, 136, 167, 0.15); color: #6288a7; padding: .3rem .8rem; border-radius: 15px; font-size: .8rem; font-weight: 500; }

    .template-actions { display: flex; gap: .5rem; }
    .btn-link { padding: .7rem 1.2rem; border: none; border-radius: 8px; cursor: pointer; font-size: .95rem; font-weight: 500; text-decoration: none; text-align: center; transition: all .3s ease; display: inline-block; }
    .btn-primary { background: var(--accent); color: var(--fg); }
    .btn-primary:hover { background: var(--bg); transform: translateY(-2px); }
    .btn-secondary { background: transparent; color: var(--bg); border: 1px solid var(--bg); }
    .btn-secondary:hover { background: var(--bg); color: var(--fg); }

    footer { background: rgba(250, 253, 255, 0.95); backdrop-filter: blur(10px); padding: 3rem 0; margin-top: 3rem; text-align: center; }
    .footer-content { color: #5a6b7a; line-height: 1.8; }
    .footer-links { margin-top: 1rem; display: flex; justify-content: center; gap: 2rem; flex-wrap: wrap; }
    .footer-links a { color: #101532; text-decoration: none; font-weight: 500; }
    .footer-links a:hover { text-decoration: underline; }
    .no-results, .loading { text-align: center; padding: 3rem; color: var(--fg); font-size: 1.1rem; }

    @media (max-width: 768px) {
      .stats { flex-direction: column; align-items: center; gap: 1.5rem; }
      .stat { width: 280px; height: 140px; }
      .search-bar { flex-direction: column; align-items: stretch; }
      .templates-grid { grid-template-columns: 1fr; }
      .footer-links { flex-direction: column; gap: 1rem; }
      header.site-header { padding: 1.5rem 0 7.5rem 0; }
      #stickyHeader nav.pill { top: 30px; width: 86vw; height: 82px; }
      #stickyHeader.sticky nav.pill { width: 86px; height: 86px; }
      .scroll-indicator { display: none; }
    }
  </style>
</head>
<body>
  <!-- Sticky / Floating pill + dropdown -->
  <div id="stickyHeader">
    <nav class="pill" aria-label="Primary">
      <a href="#templates">Templates</a>
      <a href="guide.html">Guide</a>
      <a href="support.html">Support</a>
      <a href="contribute.html">Contribute</a>
      <a href="about.html">About</a>
      <button id="openmenu" aria-label="Open menu" aria-haspopup="dialog" aria-controls="dropdownOverlay">
        <span></span><span></span>
      </button>
    </nav>
  </div>

  <!-- Fullscreen dropdown panel (opens from the button) -->
  <div class="dropdown-overlay" id="dropdownOverlay" role="dialog" aria-modal="true" aria-label="Site menu">
    <div class="dropdown-panel">
      <div class="menu-grid">
        <a class="menu-card" href="#templates">
          <h4>Browse Templates</h4>
          <p>Explore lab sites, personal pages, and package wikis.</p>
        </a>
        <a class="menu-card" href="guide.html">
          <h4>Guide</h4>
          <p>Learn how to find, customize, and deploy templates.</p>
        </a>
        <a class="menu-card" href="support.html">
          <h4>Support</h4>
          <p>Get help or report problems.</p>
        </a>
        <a class="menu-card" href="contribute.html">
          <h4>Contribute Templates</h4>
          <p>Share your designs with the community.</p>
        </a>
        <a class="menu-card" href="about.html">
          <h4>About</h4>
          <p>Learn about our mission and contributors.</p>
        </a>
        <a class="menu-card" href="https://github.com/NeuroHackademy2025/NeuroSites" target="_blank" rel="noopener">
          <h4>GitHub Repository</h4>
          <p>View source code and contribute.</p>
        </a>
      </div>
      <div class="overlay-actions">
        <button class="btn" id="closeOverlay">Close</button>
      </div>
    </div>
  </div>

  <!-- Headers & Content -->
  <header class="site-header" id="top">
    <div class="container">
      <div class="header-content">
        <div class="logo-container">
          <img src="NeuroSites-logo.jpg" alt="NeuroSites Logo" class="logo" onerror="this.style.display='none'" />
        </div>
        <p class="subtitle">Open-source website templates for the neuroscience community</p>
        <div class="stats">
        <div class="stat">
            <div class="stat-icon" aria-hidden="true">
            <!-- Flask -->
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                <path d="M10 2h4"></path>
                <path d="M10 2v6l-5 8a4.5 4.5 0 0 0 3.8 6.8h6.4A4.5 4.5 0 0 0 19 16l-5-8V2"></path>
                <path d="M9 14h6"></path>
            </svg>
            </div>
            <div>
            <div class="stat-title">Built by Scientists</div>
            <div class="stat-description">Made for neuroscientists</div>
            </div>
        </div>

        <div class="stat">
            <div class="stat-icon" aria-hidden="true">
            <!-- Cursor -->
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                <path d="M4 3l7 16 2-6 6-2L4 3z"></path>
                <path d="M13 13l5 5"></path>
            </svg>
            </div>
            <div>
            <div class="stat-title">Beginner-Friendly</div>
            <div class="stat-description">No coding experience required</div>
            </div>
        </div>

        <div class="stat">
            <div class="stat-icon" aria-hidden="true">
            <!-- Heart -->
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 21s-7-4.5-9-8a5.5 5.5 0 0 1 9-6 5.5 5.5 0 0 1 9 6c-2 3.5-9 8-9 8z"></path>
            </svg>
            </div>
            <div>
            <div class="stat-title">100% Free</div>
            <div class="stat-description">No subscriptions. No ads.</div>
            </div>
        </div>
        </div>
      </div>
      <div class="scroll-indicator" onclick="document.querySelector('main').scrollIntoView({behavior:'smooth'})">
        <div class="scroll-arrow">↓</div>
        <div class="scroll-text">Browse Templates</div>
      </div>
    </div>
  </header>

  <main id="templates">
    <div class="search-filter">
      <div class="filter-tabs">
        <button class="filter-tab active" data-category="all">All Templates</button>
        <button class="filter-tab" data-category="Event Promotions">Event Promotions</button>
        <button class="filter-tab" data-category="Lab Websites">Lab Websites</button>
        <button class="filter-tab" data-category="Personal Pages">Personal Pages</button>
        <button class="filter-tab" data-category="Package Wikis">Package Wikis</button>
      </div>
      <div class="container">
        <div class="search-section">
          <div class="search-bar">
            <div class="search-input-container">
              <input type="text" id="searchInput" placeholder="Find your next website template..." />
            </div>
          </div>
          <div class="filter-dropdowns">
            <div class="dropdown-container">
              <select class="dropdown-select" id="tagFilter">
                <option value="all">All Tags</option>
              </select>
            </div>
            <div class="dropdown-container">
              <select class="dropdown-select" id="styleFilter">
                <option value="all">All Styles</option>
                <option value="modern">Modern</option>
                <option value="minimal">Minimal</option>
                <option value="clean">Clean</option>
                <option value="professional">Professional</option>
                <option value="academic">Academic</option>
              </select>
            </div>
            <div class="dropdown-container">
              <select class="dropdown-select" id="themeFilter">
                <option value="all">All Themes</option>
                <option value="light">Light</option>
                <option value="dark">Dark</option>
                <option value="blue">Blue</option>
                <option value="neutral">Neutral</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="container">
      <div id="templatesContainer"><div class="loading">Loading templates...</div></div>
    </div>
  </main>

  <footer>
    <div class="container">
      <div class="footer-content">
        <p><strong>NeuroSites</strong> - Making beautiful neuroscience websites accessible to everyone</p>
        <p>All templates are licensed under CC BY 4.0. Use them freely, just give credit!</p>
        <div class="footer-links">
          <a href="https://github.com/NeuroHackademy2025/NeuroSites" target="_blank" rel="noopener">GitHub Repository</a>
          <a href="guide.html">Guide</a>
          <a href="support.html">Support</a>
          <a href="contribute.html">Contribute Templates</a>
          <a href="about.html">About Us</a>
          <a href="https://github.com/NeuroHackademy2025/NeuroSites/blob/main/LICENSE" target="_blank" rel="noopener">License</a>
        </div>
      </div>
    </div>
  </footer>

  <script>
    // ====== Sticky logic & dropdown interactions ======
    (function(){
      const stickyHeader = document.getElementById('stickyHeader');
      const pill = stickyHeader.querySelector('nav.pill');
      const page = document.getElementById('page') || document.body; // fallback
      const openBtn = document.getElementById('openmenu');
      const overlay = document.getElementById('dropdownOverlay');
      const closeOverlay = document.getElementById('closeOverlay');

      const onScroll = () => {
        page.classList.remove('menuopen');
        if (window.scrollY >= 100) stickyHeader.classList.add('sticky');
        else stickyHeader.classList.remove('sticky');
      };
      window.addEventListener('scroll', onScroll, { passive: true });
      onScroll();

      function openMenu(){ overlay.classList.add('active'); page.classList.add('menuopen'); }
      function closeMenu(){ overlay.classList.remove('active'); page.classList.remove('menuopen'); }

      openBtn.addEventListener('click', openMenu);
      closeOverlay.addEventListener('click', closeMenu);
      overlay.addEventListener('click', (e)=>{ if (e.target === overlay) closeMenu(); });

      // Smooth-scroll for nav links
      document.querySelectorAll('a[href^="#"]').forEach(a => {
        a.addEventListener('click', (e) => {
          const id = a.getAttribute('href');
          if (id.length > 1) {
            e.preventDefault();
            document.querySelector(id)?.scrollIntoView({ behavior: 'smooth' });
            closeMenu();
          }
        });
      });
    })();

    // ====== Template loader (fixed version from second script) ======
    let templates = [];
    let currentFilter = 'all';
    let currentTagFilter = 'all';
    let currentStyleFilter = 'all';
    let currentThemeFilter = 'all';
    let searchTerm = '';

    const searchInput = document.getElementById('searchInput');
    const tagFilter = document.getElementById('tagFilter');
    const styleFilter = document.getElementById('styleFilter');
    const themeFilter = document.getElementById('themeFilter');
    const templatesContainer = document.getElementById('templatesContainer');

    function updateStats(){
      // Stats are now static tiles, so this function is no longer needed
      // but keeping it to avoid errors in case it's called elsewhere
      console.log(`Loaded ${templates.length} templates in ${new Set(templates.map(t => t.category)).size} categories`);
    }

    function filterTemplates(){
      return templates.filter(t => {
        const matchesSearch = !searchTerm || 
          t.title.toLowerCase().includes(searchTerm) || 
          t.description.toLowerCase().includes(searchTerm) || 
          (t.tags && t.tags.some && t.tags.some(tag => tag.toLowerCase().includes(searchTerm)));
        
        const matchesCategory = currentFilter === 'all' || t.category === currentFilter;
        
        const matchesTag = currentTagFilter === 'all' || 
          (t.tags && t.tags.some && t.tags.some(tag => tag.toLowerCase().includes(currentTagFilter.toLowerCase())));
        
        const matchesStyle = currentStyleFilter === 'all' || 
          (t.style && t.style.toLowerCase() === currentStyleFilter.toLowerCase()) ||
          (t.tags && t.tags.some && t.tags.some(tag => tag.toLowerCase().includes(currentStyleFilter.toLowerCase())));
        
        const matchesTheme = currentThemeFilter === 'all' || 
          (t.theme && t.theme.toLowerCase() === currentThemeFilter.toLowerCase()) ||
          (t.tags && t.tags.some && t.tags.some(tag => tag.toLowerCase().includes(currentThemeFilter.toLowerCase())));
        
        return matchesSearch && matchesCategory && matchesTag && matchesStyle && matchesTheme;
      });
    }

    function renderTemplates(){
      const filtered = filterTemplates();
      if (!filtered.length){
        templatesContainer.innerHTML = `<div class="no-results"><p>No templates found matching your criteria.</p><p>Try adjusting your search or filter options.</p></div>`;
        return;
      }
      const html = filtered.map(t => `
        <div class="template-card" data-id="${t.id}">
          <div class="template-preview" style="${t.preview ? `background-image:url('${t.preview}');background-size:cover;background-position:center;` : ''}">${!t.preview ? '<span>Preview</span>' : ''}</div>
          <div class="template-info">
            <h3 class="template-title">${t.title}</h3>
            <p class="template-description">${t.description}</p>
            <div class="template-tags">${(t.tags && t.tags.length ? [...new Set(t.tags)].map(tag => `<span class="tag">${tag}</span>`).join('') : `<span class="tag">${t.category}</span>`)}</div>
            <div class="template-actions">
              <a class="btn-link btn-primary" href="${t.demoUrl}" target="_blank" rel="noopener">View Template</a>
              <a class="btn-link btn-secondary" href="${t.downloadUrl}" target="_blank" rel="noopener">View Code</a>
            </div>
          </div>
        </div>`).join('');
      templatesContainer.innerHTML = `<div class="templates-grid">${html}</div>`;
    }

    function setupFilters(){
      const filterContainer = document.querySelector('.filter-tabs');
      filterContainer.addEventListener('click', (e)=>{
        const btn = e.target.closest('button');
        if (!btn) return;
        filterContainer.querySelectorAll('button').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentFilter = btn.dataset.category;
        renderTemplates();
      });

      searchInput.addEventListener('input', (e)=>{ 
        searchTerm = e.target.value.toLowerCase(); 
        renderTemplates(); 
      });

      // Add dropdown filter event listeners
      tagFilter.addEventListener('change', (e) => {
        currentTagFilter = e.target.value;
        renderTemplates();
      });

      styleFilter.addEventListener('change', (e) => {
        currentStyleFilter = e.target.value;
        renderTemplates();
      });

      themeFilter.addEventListener('change', (e) => {
        currentThemeFilter = e.target.value;
        renderTemplates();
      });
    }

    function updateTagDropdown() {
      // Populate tag dropdown with available tags from templates
      const allTags = new Set();
      templates.forEach(t => {
        if (t.tags && Array.isArray(t.tags)) {
          t.tags.forEach(tag => allTags.add(tag));
        }
      });
      
      // Clear existing options except "All Tags"
      tagFilter.innerHTML = '<option value="all">All Tags</option>';
      
      // Add tag options
      [...allTags].sort().forEach(tag => {
        const option = document.createElement('option');
        option.value = tag.toLowerCase();
        option.textContent = tag;
        tagFilter.appendChild(option);
      });
    }

    // Load filter configuration from JSON
    async function loadFilterConfig() {
      try {
        const response = await fetch('./filter-config.json');
        const config = await response.json();
        
        // Populate style dropdown
        styleFilter.innerHTML = '<option value="all">All Styles</option>';
        config.styles.forEach(style => {
          const option = document.createElement('option');
          option.value = style.toLowerCase();
          option.textContent = style;
          styleFilter.appendChild(option);
        });
        
        // Populate theme dropdown
        themeFilter.innerHTML = '<option value="all">All Themes</option>';
        config.themes.forEach(theme => {
          const option = document.createElement('option');
          option.value = theme.toLowerCase();
          option.textContent = theme;
          themeFilter.appendChild(option);
        });
        
        console.log('Filter configuration loaded successfully');
      } catch (error) {
        console.warn('Could not load filter configuration, using defaults:', error);
        // Keep the existing hardcoded options as fallback
      }
    }

    function updateFilterButtons() {
      const categories = [...new Set(templates.map(t => t.category))];
      const filterContainer = document.querySelector('.filter-tabs');
      
      // Clear container and rebuild all buttons
      filterContainer.innerHTML = '';
      
      // Create "All Templates" button
      const allButton = document.createElement('button');
      allButton.className = 'filter-tab active';
      allButton.dataset.category = 'all';
      allButton.textContent = 'All Templates';
      allButton.addEventListener('click', (e) => {
        document.querySelectorAll('.filter-tab').forEach(b => b.classList.remove('active'));
        e.target.classList.add('active');
        currentFilter = 'all';
        renderTemplates();
      });
      filterContainer.appendChild(allButton);
      
      // Create category buttons
      categories.forEach(category => {
        const button = document.createElement('button');
        button.className = 'filter-tab';
        button.dataset.category = category;
        button.textContent = category;
        button.addEventListener('click', (e) => {
          document.querySelectorAll('.filter-tab').forEach(b => b.classList.remove('active'));
          e.target.classList.add('active');
          currentFilter = e.target.dataset.category;
          renderTemplates();
        });
        filterContainer.appendChild(button);
      });
    }


    // Temporary static template data for styling development
    function loadDevelopmentTemplates() {
      templates = [
        {
          id: 'lab-template-1',
          title: 'Modern Lab Website',
          description: 'A clean and modern lab website template with sections for research, publications, and team members.',
          category: 'Lab Websites',
          tags: ['Research', 'Publications', 'Team'],
          style: 'Modern',
          theme: 'Blue',
          preview: null,
          demoUrl: '#',
          downloadUrl: '#'
        },
        {
          id: 'personal-page-1',
          title: 'Academic Portfolio',
          description: 'A professional personal page template perfect for academic researchers and professionals.',
          category: 'Personal Pages',
          tags: ['Professional', 'Academic', 'Portfolio'],
          style: 'Modern',
          theme: 'Light',
          preview: null,
          demoUrl: '#',
          downloadUrl: '#'
        },
        {
          id: 'event-template-1',
          title: 'Conference Website',
          description: 'A comprehensive event promotion template perfect for conferences, workshops, and symposiums.',
          category: 'Event Promotions',
          tags: ['Conference', 'Workshop', 'Event'],
          style: 'Professional',
          theme: 'Dark',
          preview: null,
          demoUrl: '#',
          downloadUrl: '#'
        },
        {
          id: 'package-wiki-1',
          title: 'Python Package Docs',
          description: 'A clean documentation template for Python packages with comprehensive sections.',
          category: 'Package Wikis',
          tags: ['Python', 'Documentation'],
          style: 'Clean',
          theme: 'Neutral',
          preview: null,
          demoUrl: '#',
          downloadUrl: '#'
        },
        {
          id: 'lab-template-2',
          title: 'Minimal Lab Site',
          description: 'A minimal and clean lab website template focusing on content over design.',
          category: 'Lab Websites',
          tags: ['Minimal', 'Simple'],
          style: 'Minimal',
          theme: 'Light',
          preview: null,
          demoUrl: '#',
          downloadUrl: '#'
        },
        {
          id: 'personal-page-2',
          title: 'Researcher Profile',
          description: 'A comprehensive personal page template for researchers with CV and publications.',
          category: 'Personal Pages',
          tags: ['CV', 'Publications', 'Academic'],
          style: 'Professional',
          theme: 'Blue',
          preview: null,
          demoUrl: '#',
          downloadUrl: '#'
        }
      ];
      
      console.log('Loaded development templates:', templates);
      updateStats();
      updateTagDropdown();
      renderTemplates();
      updateFilterButtons();
    }

    async function fetchTemplatesFromRepository(){
      // Temporarily use static data for development
      console.log('Using development templates for styling work...');
      templatesContainer.innerHTML = '<div class="loading">Loading templates...</div>';
      
      // Simulate loading delay
      setTimeout(() => {
        loadDevelopmentTemplates();
      }, 500);
      
      return;
      
      // Original API code (commented out for development):
      /*
      try {
        templatesContainer.innerHTML = '<div class="loading">Loading templates...</div>';
        
        console.log('Fetching templates from repository...');
        
        const res = await fetch('https://api.github.com/repos/NeuroHackademy2025/NeuroSites/contents/templates');
        if (!res.ok) {
          throw new Error(`GitHub API error: HTTP ${res.status} - ${res.statusText}`);
        }
        
        const cats = (await res.json()).filter(x => x.type === 'dir' && !x.name.startsWith('.'));
        console.log('Template categories found:', cats.map(c => c.name));
        
        templates = [];
        for (const cat of cats){
          console.log(`Processing category: ${cat.name}`);
          
          const r2 = await fetch(`https://api.github.com/repos/NeuroHackademy2025/NeuroSites/contents/templates/${cat.name}`);
          if (!r2.ok) {
            console.warn(`Failed to fetch category ${cat.name}: HTTP ${r2.status}`);
            continue;
          }
          
          const contents = await r2.json();
          const dirs = contents.filter(x => x.type === 'dir' && !x.name.startsWith('.'));
          
          console.log(`Template dirs in ${cat.name}:`, dirs.map(d => d.name));
          
          for (const d of dirs){
            // Detect if we're running locally or on GitHub Pages
            const isLocal = window.location.protocol === 'file:';
            const baseUrl = isLocal ? 'https://neurohackademy2025.github.io/NeuroSites/' : '';
            
            let t = {
              id: d.name,
              title: d.name.replace(/-/g,' ').replace(/\b\w/g, c => c.toUpperCase()),
              description: `A ${cat.name.replace('-', ' ')} template for neuroscience websites.`,
              category: cat.name.replace(/-/g,' ').replace(/\b\w/g, c => c.toUpperCase()),
              tags: [], preview: null,
              demoUrl: baseUrl + `templates/${cat.name}/${d.name}/`,
              downloadUrl: `https://download-directory.github.io/?url=https://github.com/NeuroHackademy2025/NeuroSites/tree/main/templates/${cat.name}/${d.name}`
            };
            
            // Try to fetch additional details (manifest, preview) but don't fail if they're missing
            try {
              const r3 = await fetch(`https://api.github.com/repos/NeuroHackademy2025/NeuroSites/contents/templates/${cat.name}/${d.name}`);
              if (r3.ok) {
                const files = await r3.json();
                
                // Look for manifest.json
                const manifest = files.find(f => f.name === 'manifest.json');
                if (manifest) {
                  try {
                    const manifestData = await (await fetch(manifest.download_url)).json();
                    Object.assign(t, manifestData);
                  } catch (manifestError) {
                    console.warn(`Could not parse manifest for ${d.name}:`, manifestError);
                  }
                }
                
                // Look for preview image
                const preview = files.find(f => f.name === 'preview.png' || f.name === 'preview.jpg');
                if (preview) {
                  t.preview = preview.download_url;
                }
              }
            } catch (templateError) {
              console.warn(`Could not fetch details for template ${d.name}:`, templateError);
            }
            
            // Ensure tags are properly formatted
            if (Array.isArray(t.tags)){
              t.tags = [...new Set(t.tags.filter(tag => tag !== t.category))];
              if (!t.tags.length) t.tags = [t.category];
            } else {
              t.tags = [t.category];
            }
            
            templates.push(t);
            console.log(`Added template:`, t);
          }
        }
        
        console.log('Final templates array:', templates);
        
        if (templates.length > 0) {
          updateStats();
          renderTemplates();
          updateFilterButtons();
        } else {
          templatesContainer.innerHTML = `<div class="no-results"><p>No templates found in the repository.</p><p>This could be due to repository structure changes or network issues.</p></div>`;
        }
        
      } catch (err){
        console.error('Error fetching templates:', err);
        let errorMessage = 'Error loading templates from repository.';
        
        if (err.message.includes('403')) {
          errorMessage = 'GitHub API rate limit exceeded. Please try again later or view the site on GitHub Pages.';
        } else if (err.message.includes('404')) {
          errorMessage = 'Repository or templates folder not found.';
        } else if (err.message.includes('Failed to fetch')) {
          errorMessage = 'Network error. Please check your internet connection.';
        }
        
        templatesContainer.innerHTML = `<div class="no-results">
          <p>${errorMessage}</p>
          <p>Error details: ${err.message}</p>
          <p>Try visiting the <a href="https://neurohackademy2025.github.io/NeuroSites/" target="_blank" style="color: #6288a7; text-decoration: underline;">live GitHub Pages site</a> instead.</p>
        </div>`;
      }
      */
    }

    document.addEventListener('DOMContentLoaded', () => { 
      setupFilters(); 
      loadFilterConfig(); // Load dropdown options from JSON
      fetchTemplatesFromRepository(); 
    });
  </script>
</body>
</html>
